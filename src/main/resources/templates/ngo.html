<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title th:text="${pageTitle}">Community Donation Directory</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/ngo.css">
</head>
<body>
  <!-- Header -->
  <header class="header-gradient">
    <div class="container header">
      <div class="top-row">
        <div>
          <div class="chip chip-pad soft-shadow" aria-label="Directory badge">
            <span aria-hidden="true">ü§ù</span>
            <span>Community Donation Directory</span>
          </div>
          <h1 style="margin:16px 0 8px; font-size:clamp(28px, 3vw, 40px); font-weight:800; letter-spacing:-0.02em; color:var(--dark-brown)">
            Give where it matters most
          </h1>
          <p style="margin:0; font-size:clamp(16px, 2vw, 18px); color:#6B4F3A">
            Discover local NGOs, see what they accept, and lend a hand today.
          </p>
        </div>
        <!-- Emblem -->
        <div class="emblem card-gradient soft-shadow" aria-hidden="true">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
            <defs>
              <linearGradient id="em" x1="0" y1="0" x2="24" y2="24">
                <stop stop-color="#D9A75C"/>
                <stop offset="1" stop-color="#8B5E3C"/>
              </linearGradient>
            </defs>
            <path d="M12 21s-7-4.35-9.5-8.5C.94 9.06 2.36 5.5 5.5 5.5c1.93 0 3.04 1.23 3.84 2.36.21.29.42.6.66.94.24-.34.45-.65.66-.94C11.46 6.73 12.57 5.5 14.5 5.5c3.14 0 4.56 3.56 3 7C19 16.65 12 21 12 21z" fill="url(#em)"/>
          </svg>
        </div>
      </div>

      <!-- Controls -->
      <div class="controls">
        <!-- Search -->
        <div class="control-wrap soft-shadow hover-lift">
          <form id="filterForm" th:action="@{/ngo}" method="get">
            <label for="search" class="sr-only" style="position:absolute; left:-9999px">Search NGOs</label>
            <div class="search-field">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M21 21l-3.9-3.9M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15z" stroke="#8B5E3C" stroke-width="1.6" stroke-linecap="round"/>
              </svg>
              <input id="search" name="search" th:value="${search}" type="text" placeholder="Search by name, city, or item..." class="search-input focus-ring" oninput="setTimeout(() => this.form.submit(), 300)" />
            </div>

            <!-- Filters row -->
            <div class="filters-row">
              <!-- City -->
              <div class="control-wrap soft-shadow hover-lift">
                <label for="city" class="select-label">City</label>
                <div class="select-holder">
                  <span class="select-icon" aria-hidden="true">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 2C8 2 5 5 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-4-3-7-7-7z" stroke="#8B5E3C" stroke-width="1.3" fill="rgba(139,94,60,0.12)"/></svg>
                  </span>
                  <select id="city" name="city" class="select focus-ring" onchange="this.form.submit()">
                    <option value="all">All cities</option>
                    <option th:each="city : ${cities}" th:value="${city}" th:text="${city}" th:selected="${city == selectedCity}"></option>
                  </select>
                  <span class="select-caret" aria-hidden="true">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke="#8B5E3C" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  </span>
                </div>
              </div>

              <!-- Item Type -->
              <div class="control-wrap soft-shadow hover-lift">
                <label for="item" class="select-label">Item type</label>
                <div class="select-holder">
                  <span class="select-icon" aria-hidden="true">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 7h16M6 11h12M8 15h8" stroke="#8B5E3C" stroke-width="1.6" stroke-linecap="round"/></svg>
                  </span>
                  <select id="item" name="item" class="select focus-ring" onchange="this.form.submit()">
                    <option value="all">All items</option>
                    <option th:each="item : ${itemTypes}" th:value="${item}" th:text="${item}" th:selected="${item == selectedItem}"></option>
                  </select>
                  <span class="select-caret" aria-hidden="true">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke="#8B5E3C" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  </span>
                </div>
              </div>
            </div>
          </form>
        </div>

        <!-- Active chips + result count -->
        <div class="chips-row">
          <div id="activeChips" style="display:flex; flex-wrap:wrap; gap:8px;">
            <div th:if="${search != ''}" class="chip chip-pad hover-lift">
              <span th:text="'Search: ' + ${search}"></span>
              <a th:href="@{/ngo(city=${selectedCity}, item=${selectedItem})}" aria-label="Remove search filter">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M6 6l12 12M18 6L6 18" stroke="#5A3E2B" stroke-linecap="round" stroke-width="1.8"/></svg>
              </a>
            </div>
            <div th:if="${selectedCity != 'all'}" class="chip chip-pad hover-lift">
              <span th:text="'City: ' + ${selectedCity}"></span>
              <a th:href="@{/ngo(search=${search}, item=${selectedItem})}" aria-label="Remove city filter">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M6 6l12 12M18 6L6 18" stroke="#5A3E2B" stroke-linecap="round" stroke-width="1.8"/></svg>
              </a>
            </div>
            <div th:if="${selectedItem != 'all'}" class="chip chip-pad hover-lift">
              <span th:text="'Item: ' + ${selectedItem}"></span>
              <a th:href="@{/ngo(search=${search}, city=${selectedCity})}" aria-label="Remove item filter">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M6 6l12 12M18 6L6 18" stroke="#5A3E2B" stroke-linecap="round" stroke-width="1.8"/></svg>
              </a>
            </div>
          </div>
          <div class="chips-right">
            <span id="resultCount" class="badge soft-shadow" th:text="${#lists.size(ngos)} + ' ' + (${#lists.size(ngos) == 1} ? 'result' : 'results')">0 results</span>
            <a th:if="${search != '' or selectedCity != 'all' or selectedItem != 'all'}" th:href="@{/ngo}" class="chip chip-pad hover-lift focus-ring">Clear filters</a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="container" style="padding:32px 0 48px;">
    <div class="divider"></div>

    <!-- Grid -->
    <section id="grid" class="cards">
      <article th:each="ngo : ${ngos}" class="card card-gradient soft-shadow hover-lift">
        <div>
          <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:12px;">
            <div style="display:flex; align-items:center; gap:12px;">
              <div class="avatar-ring">
                <svg width="56" height="56" viewBox="0 0 56 56" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                  <defs>
                    <radialGradient th:id="'a-' + ${ngo.name.replaceAll('\\W', '')}" cx="20%" cy="15%" r="80%">
                      <stop offset="0%" stop-color="#D9A75C"/>
                      <stop offset="100%" stop-color="#CDAF91"/>
                    </radialGradient>
                  </defs>
                  <circle cx="28" cy="28" r="26" th:attr="fill='url(#a-' + ${ngo.name.replaceAll('\\W', '')} + ')'" />
                  <circle cx="28" cy="28" r="26" fill="rgba(255,255,255,.15)"/>
                  <text x="50%" y="54%" text-anchor="middle" font-family="Nunito, sans-serif" font-weight="800" font-size="18" fill="#5A3E2B"
                        th:text="${#strings.substring(ngo.name, 0, 1) + (#strings.contains(ngo.name, ' ') ? #strings.substring(#strings.substringAfter(ngo.name, ' '), 0, 1) : '')}"></text>
                </svg>
              </div>
              <div>
                <h3 style="margin:0; font-size:clamp(18px, 2vw, 20px); font-weight:800; color:var(--dark-brown)" th:text="${ngo.name}"></h3>
                <div class="badge" style="margin-top:6px;">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 2C8 2 5 5 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-4-3-7-7-7z" stroke="#8B5E3C" stroke-width="1.3" fill="rgba(139,94,60,0.12)"/></svg>
                  <span th:text="${ngo.city}"></span>
                </div>
              </div>
            </div>
          </div>
          <div style="margin-top:12px; display:flex; flex-wrap:wrap; gap:8px;">
            <span th:each="item : ${ngo.items}" class="tag soft-shadow" th:text="${item}"></span>
          </div>
        </div>
        <div style="margin-top:16px; display:grid; grid-template-columns:1fr 1fr; gap:10px;">
          <a th:href="@{/ngo(search=${search}, city=${selectedCity}, item=${selectedItem}, ngoId=${ngo.id})}" class="btn btn-gold soft-shadow hover-lift focus-ring">Donate</a>
          <a th:href="'mailto:' + ${ngo.email}" class="btn btn-brown soft-shadow hover-lift focus-ring" style="text-align:center; text-decoration:none;">Contact</a>
        </div>
      </article>
    </section>

    <!-- Empty state -->
    <div id="emptyState" class="card-gradient empty soft-shadow-lg" th:style="${#lists.isEmpty(ngos)} ? 'display:block' : 'display:none'">
      <div class="avatar-ring" style="margin:0 auto;">
        <svg width="34" height="34" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 21s-7-4.35-9.5-8.5C.94 9.06 2.36 5.5 5.5 5.5c1.93 0 3.04 1.23 3.84 2.36.21.29.42.6.66.94.24-.34.45-.65.66-.94C11.46 6.73 12.57 5.5 14.5 5.5c3.14 0 4.56 3.56 3 7C19 16.65 12 21 12 21z" fill="url(#g2)"/>
          <defs><linearGradient id="g2" x1="0" y1="0" x2="24" y2="24"><stop stop-color="#D9A75C"/><stop offset="1" stop-color="#8B5E3C"/></linearGradient></defs>
        </svg>
      </div>
      <h3 style="margin:20px 0 4px; font-size:24px; font-weight:800; color:var(--dark-brown)">No matches yet</h3>
      <p id="emptyMessage" style="margin:0; color:#6B4F3A">Try a different item or clear your filters to explore more NGOs.</p>
      <a th:href="@{/ngo}" class="btn btn-gold soft-shadow hover-lift focus-ring" style="margin-top:20px;">Reset filters</a>
    </div>
  </main>

  <!-- Donate Modal -->
  <div id="modal" class="modal" th:style="${selectedNgoId != null} ? 'display:block' : 'display:none'">
    <div class="modal-backdrop"></div>
    <div class="modal-card glass soft-shadow-lg">
      <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:16px;">
        <div style="display:flex; align-items:center; gap:12px;">
          <div class="avatar-ring" aria-hidden="true">
            <span style="font-size:20px;">üéÅ</span>
          </div>
          <div>
            <h4 id="modalTitle" style="margin:0; font-size:clamp(20px, 2.2vw, 24px); font-weight:800; color:var(--dark-brown)"
                th:text="${selectedNgoId != null} ? ('Donate to ' + ${ngos.?[#this.id == selectedNgoId][0]?.name ?: 'NGO'}) : 'Donate'"></h4>
            <p id="modalSubtitle" style="margin:4px 0 0; font-size:14px; color:#6B4F3A"
               th:text="${selectedNgoId != null} ? (${ngos.?[#this.id == selectedNgoId][0]?.city ?: 'Unknown'} + ' ‚Ä¢ Contact: ' + ${ngos.?[#this.id == selectedNgoId][0]?.email ?: 'N/A'}) : 'Select an NGO'"></p>
          </div>
        </div>
        <a th:href="@{/ngo(search=${search}, city=${selectedCity}, item=${selectedItem})}" class="chip hover-lift focus-ring" style="border-radius:12px; padding:8px;" aria-label="Close donate dialog">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M6 6l12 12M18 6L6 18" stroke="#5A3E2B" stroke-linecap="round" stroke-width="1.8"/></svg>
        </a>
      </div>

      <div style="margin-top:16px; font-size:15px; color:#5A3E2B">
        <div class="badge" style="padding:6px 10px; display:inline-flex; align-items:center; gap:8px; font-size:13px;">
          <span aria-hidden="true">‚ÑπÔ∏è</span>
          <span>This is a demo ‚Äî no payments are processed here.</span>
        </div>

        <div style="margin-top:16px; padding:16px; border-radius:12px; background:rgba(241,228,211,0.6); border:1px solid rgba(139,94,60,0.25)">
          <p style="margin:0 0 8px; font-weight:700;">How to help</p>
          <ul style="margin:0; padding-left:18px;">
            <li>Contact the NGO to arrange drop-off or pick-up.</li>
            <li>Confirm the items they currently accept.</li>
            <li>Share this listing with friends and neighbors.</li>
          </ul>
        </div>

        <div style="margin-top:16px; display:grid; grid-template-columns:1fr; gap:12px;">
          <a th:href="${selectedNgoId != null} ? ${ngos.?[#this.id == selectedNgoId][0]?.website ?: '#'}" 
             th:style="${selectedNgoId != null and ngos.?[#this.id == selectedNgoId][0]?.website != null} ? 'pointer-events:auto;opacity:1' : 'pointer-events:none;opacity:.6'"
             target="_blank" rel="noopener" class="chip hover-lift focus-ring" style="text-align:center; font-weight:700; padding:12px 16px; border-radius:12px; text-decoration:none; color:inherit;">Visit website</a>
          <a th:href="${selectedNgoId != null} ? ('mailto:' + ${ngos.?[#this.id == selectedNgoId][0]?.email ?: ''}) : '#'"
             th:style="${selectedNgoId != null and ngos.?[#this.id == selectedNgoId][0]?.email != null} ? 'pointer-events:auto;opacity:1' : 'pointer-events:none;opacity:.6'"
             class="btn btn-gold soft-shadow hover-lift focus-ring" style="width:100%; text-align:center; text-decoration:none;">Contact via email</a>
        </div>

        <div id="modalAccepted" style="margin-top:12px; font-size:14px; color:#6B4F3A">
          <span style="font-weight:700">Currently accepts:</span>
          <span th:if="${selectedNgoId != null and not #lists.isEmpty(ngos.?[#this.id == selectedNgoId][0]?.items)}"
                th:each="item : ${ngos.?[#this.id == selectedNgoId][0]?.items}"
                class="tag" style="display:inline-block; margin:4px 6px 0 0;" th:text="${item}"></span>
          <span th:if="${selectedNgoId == null or #lists.isEmpty(ngos.?[#this.id == selectedNgoId][0]?.items)}">None</span>
        </div>
      </div>
    </div>
  </div>

  <footer>
    Built with care for communities. Be kind, give thoughtfully.
  </footer>
</body>
</html>